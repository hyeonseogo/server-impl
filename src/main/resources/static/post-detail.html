<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ìƒì„¸</title>
</head>
<body>
<nav>
    <a href="post-list.html">ğŸ  í™ˆ</a>
    <a href="create-post.html" id="navWrite" style="display:none;">âœï¸ ê¸€ì“°ê¸°</a>
    <a href="mypage.html">ğŸ™ ë§ˆì´í˜ì´ì§€</a>
    <a href="login.html" id="navLogin">ğŸ” ë¡œê·¸ì¸</a>
    <a href="#" id="navLogout" style="display:none;">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
</nav>
<hr>

<h1>ê²Œì‹œê¸€ ìƒì„¸</h1>
<div id="postContent">
    <p>ë¡œë”© ì¤‘...</p>
</div>

<button id="editBtn" style="display: none;">ìˆ˜ì •</button>
<button id="deleteBtn" style="display: none;">ì‚­ì œ</button>
<button onclick="window.location.href='post-list.html'">ëª©ë¡ìœ¼ë¡œ</button>

<script>
    const token = localStorage.getItem("token");
    const params = new URLSearchParams(window.location.search);
    const postId = params.get("id");

    const postContent = document.getElementById("postContent");
    const editBtn = document.getElementById("editBtn");
    const deleteBtn = document.getElementById("deleteBtn");

    let writerId = null;

    // nav ë²„íŠ¼ ì œì–´
    if (token) {
        document.getElementById("navWrite").style.display = "inline";
        document.getElementById("navLogin").style.display = "none";
        document.getElementById("navLogout").style.display = "inline";
    }

    document.getElementById("navLogout").addEventListener("click", () => {
        localStorage.removeItem("token");
        alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤");
        window.location.href = "login.html";
    });

    // ê²Œì‹œê¸€ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    fetch(`/api/posts/${postId}`)
        .then(res => res.json())
        .then(post => {
            writerId = post.writerId;
            postContent.innerHTML = `
          <h2>${post.title}</h2>
          <p>${post.content}</p>
          <p><strong>ì‘ì„±ì:</strong> ${post.writerName}</p>
          <p><strong>ì‘ì„±ì¼:</strong> ${post.createdAt || ''}</p>
        `;

            // ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            if (token) {
                fetch("/api/member/info", {
                    method: "GET",
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                })
                    .then(res => res.json())
                    .then(user => {
                        if (user.id === writerId) {
                            editBtn.style.display = "inline-block";
                            deleteBtn.style.display = "inline-block";
                        }
                    });
            }
        })
        .catch(err => {
            console.error("ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨:", err);
            alert("ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        });

    // ìˆ˜ì • ë²„íŠ¼ í´ë¦­
    editBtn.addEventListener("click", () => {
        window.location.href = `update-post.html?id=${postId}`;
    });

    // ì‚­ì œ ë²„íŠ¼ í´ë¦­
    deleteBtn.addEventListener("click", () => {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        fetch(`/api/posts/${postId}`, {
            method: "DELETE",
            headers: {
                "Authorization": "Bearer " + token
            }
        })
            .then(res => {
                if (res.ok) {
                    alert("ì‚­ì œ ì„±ê³µ");
                    window.location.href = "post-list.html";
                } else {
                    throw new Error("ì‚­ì œ ê¶Œí•œ ì—†ìŒ");
                }
            })
            .catch(err => {
                alert(err.message);
            });
    });
</script>
</body>
</html>
