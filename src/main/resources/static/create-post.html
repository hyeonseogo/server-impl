<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>๊ฒ์๊ธ ์์ฑ</title>
</head>
<body>
<nav>
  <a href="post-list.html">๐ ํ</a>
  <a href="create-post.html" id="navWrite" style="display:none;">โ๏ธ ๊ธ์ฐ๊ธฐ</a>
  <a href="mypage.html">๐ ๋ง์ดํ์ด์ง</a>
  <a href="login.html" id="navLogin">๐ ๋ก๊ทธ์ธ</a>
  <a href="#" id="navLogout" style="display:none;">๐ช ๋ก๊ทธ์์</a>
</nav>
<hr>

<h1>๊ฒ์๊ธ ์์ฑ</h1>
<form id="postForm">
  <input type="text" id="title" placeholder="์๋ชฉ" required><br><br>
  <textarea id="content" placeholder="๋ด์ฉ" rows="10" cols="50" required></textarea><br><br>
  <button type="submit">์์ฑ</button>
  <button type="button" onclick="window.location.href='post-list.html'">๋ชฉ๋ก์ผ๋ก</button>
</form>

<script>
  const token = localStorage.getItem("token");

  // ๋ก๊ทธ์ธ ์ ๋์ด ์์ผ๋ฉด ๋ก๊ทธ์ธ ํ์ด์ง๋ก ์ด๋
  if (!token) {
    alert("๋ก๊ทธ์ธ์ด ํ์ํฉ๋๋ค.");
    window.location.href = "login.html";
  }

  // nav ๋ฒํผ ์์ด
  if (token) {
    document.getElementById("navWrite").style.display = "inline";
    document.getElementById("navLogin").style.display = "none";
    document.getElementById("navLogout").style.display = "inline";
  }

  document.getElementById("navLogout").addEventListener("click", () => {
    localStorage.removeItem("token");
    alert("๋ก๊ทธ์์ ๋์์ต๋๋ค");
    window.location.href = "login.html";
  });

  // ๊ฒ์๊ธ ์์ฑ ์์ฒญ
  document.getElementById("postForm").addEventListener("submit", function(e) {
    e.preventDefault();

    fetch("/api/posts", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({
        title: document.getElementById("title").value,
        content: document.getElementById("content").value
      })
    })
            .then(res => {
              if (res.ok) {
                alert("๊ฒ์๊ธ ์์ฑ ์ฑ๊ณต");
                window.location.href = "post-list.html";
              } else {
                throw new Error("์์ฑ ์คํจ ๋๋ ๊ถํ ์์");
              }
            })
            .catch(err => {
              alert(err.message);
            });
  });
</script>
</body>
</html>
