<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œê¸€ ëª©ë¡</title>
</head>
<body>
<nav>
    <a href="post-list.html">ğŸ  í™ˆ</a>
    <a href="create-post.html" id="navWrite" style="display:none;">âœï¸ ê¸€ì“°ê¸°</a>
    <a href="mypage.html">ğŸ™ ë§ˆì´í˜ì´ì§€</a>
    <a href="login.html" id="navLogin">ğŸ” ë¡œê·¸ì¸</a>
    <a href="#" id="navLogout" style="display:none;">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
</nav>
<hr>

<h1>ê²Œì‹œê¸€ ëª©ë¡</h1>
<div id="postList"></div>
<div id="pagination"></div>

<button id="writeBtn" style="display:none;">ê¸€ì“°ê¸°</button>
<button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>

<script>
    const token = localStorage.getItem("token");

    if (token) {
        document.getElementById("navWrite").style.display = "inline";
        document.getElementById("navLogin").style.display = "none";
        document.getElementById("navLogout").style.display = "inline";
        document.getElementById("writeBtn").style.display = "inline-block";
    }

    document.getElementById("navLogout").addEventListener("click", () => {
        localStorage.removeItem("token");
        alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤");
        window.location.href = "login.html";
    });

    document.getElementById("logoutBtn").addEventListener("click", () => {
        localStorage.removeItem("token");
        alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤");
        window.location.href = "login.html";
    });

    document.getElementById("writeBtn").addEventListener("click", () => {
        window.location.href = "create-post.html";
    });

    const params = new URLSearchParams(window.location.search);
    const currentPage = parseInt(params.get("page")) || 0;
    const pageSize = 10;

    fetch(`/api/posts?page=${currentPage}&size=${pageSize}`)
        .then(res => res.json())
        .then(data => {
            const posts = data.posts;
            const totalCount = data.totalCount;
            const totalPages = Math.ceil(totalCount / pageSize);

            const listDiv = document.getElementById("postList");
            listDiv.innerHTML = "";

            if (!posts || posts.length === 0) {
                listDiv.innerHTML = "<p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
                return;
            }

            posts.forEach(post => {
                const div = document.createElement("div");
                div.innerHTML = `<a href="post-detail.html?id=${post.id}">${post.title}</a> | ì‘ì„±ì: ${post.writerName}`;
                listDiv.appendChild(div);
            });

            const paginationDiv = document.getElementById("pagination");
            paginationDiv.innerHTML = "";

            for (let i = 0; i < totalPages; i++) {
                const btn = document.createElement("button");
                btn.textContent = i + 1;
                if (i === currentPage) {
                    btn.disabled = true;
                }
                btn.addEventListener("click", () => {
                    window.location.href = `post-list.html?page=${i}`;
                });
                paginationDiv.appendChild(btn);
            }
        })
        .catch(err => {
            console.error("ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:", err);
            alert("ê²Œì‹œê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
        });
</script>
</body>
</html>
